<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Game Study</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f3f4f6; color: #111; padding: 20px; }
    .game-board { display: grid; grid-template-columns: repeat(3, 100px); gap: 10px; justify-content: center; margin: 20px 0; }
    .card { width: 100px; height: 100px; font-size: 2em; background: #4f46e5; color: white; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; }
    .hidden { background: #a5b4fc; color: transparent; }
    table { margin: 20px auto; border-collapse: collapse; }
    th, td { border: 1px solid black; padding: 8px 12px; }
     #time {
    display: none;
  }
    #popup { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10; }
    #popup-content { background: white; padding: 20px; border-radius: 10px; text-align: center; max-width: 300px; }
  </style>
</head>
<body>
  <div id="popup">
    <div id="popup-content">
      <h2>Welcome!</h2>
      <p>This game includes different sound conditions.<br><strong>Please wear headphones.</strong></p>
      <button onclick="startGame()">Start</button>
    </div>
  </div>

  <h1>Memory Game</h1>
  <h3 id="round-info">Round 1</h3>
  <p><strong>Time:</strong> <span id="time">0.000000s</span></p>
  <div class="game-board" id="game-board"></div>

  <div id="results" style="display:none;">
    <h2>Results</h2>
    <table>
      <thead><tr><th>Round 1</th><th>Round 2</th><th>Round 3</th></tr></thead>
      <tbody><tr id="results-row"></tr></tbody>
    </table>
  </div>

  <audio id="loud-audio" src="loud-music.mp3" preload="auto"></audio>
  <audio id="focus-audio" src="focus-music.mp3" preload="auto"></audio>

  <script>
    const board = document.getElementById("game-board");
    const timeDisplay = document.getElementById("time");
    const roundInfo = document.getElementById("round-info");
    const results = document.getElementById("results");
    const resultsRow = document.getElementById("results-row");
    const popup = document.getElementById("popup");

    const loudAudio = document.getElementById("loud-audio");
    const focusAudio = document.getElementById("focus-audio");

    let round = 1;
    let flipped = [], matches = 0;
    const times = [];
    let startTime = 0, frameRequest = null;

    function startGame() {
      popup.style.display = "none";
      startRound();
    }

    function startRound() {
      stopAudio();
      if (round === 2) loudAudio.play();
      if (round === 3) focusAudio.play();
      roundInfo.textContent = "Round " + round;
      matches = 0;
      timeDisplay.textContent = "0.000000s";
      createBoard();
      startTime = performance.now();
      updateTimer();
    }

    function stopAudio() {
      [loudAudio, focusAudio].forEach(a => { a.pause(); a.currentTime = 0; });
    }

    function createBoard() {
      board.innerHTML = "";
      const symbols = shuffle(["A", "A", "B", "B", "C", "C"]);
      symbols.forEach(sym => {
        const card = document.createElement("div");
        card.className = "card hidden";
        card.textContent = sym;
        card.onclick = () => flip(card);
        board.appendChild(card);
      });
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function flip(card) {
      if (!card.classList.contains("hidden") || flipped.length === 2) return;
      card.classList.remove("hidden");
      flipped.push(card);
      if (flipped.length === 2) {
        setTimeout(() => {
          if (flipped[0].textContent !== flipped[1].textContent) {
            flipped.forEach(c => c.classList.add("hidden"));
          } else {
            matches++;
          }
          flipped = [];
          if (matches === 3) endRound();
        }, 500);
      }
    }

    function updateTimer() {
      const now = performance.now();
      const elapsed = (now - startTime) / 1000;
      timeDisplay.textContent = elapsed.toFixed(8) + "s";
      frameRequest = requestAnimationFrame(updateTimer);
    }

    function endRound() {
      cancelAnimationFrame(frameRequest);
      const endTime = performance.now();
      const duration = (endTime - startTime) / 1000;
      const precise = Number(duration.toFixed(8));
      times.push(precise);

      if (round < 3) {
        round++;
        setTimeout(startRound, 1000);
      } else {
        stopAudio();
        showResults();
        sendToSheet();
      }
    }

    function showResults() {
      results.style.display = "block";
      resultsRow.innerHTML = times.map(t => `<td>${t.toFixed(8)}s</td>`).join("");
    }

    function sendToSheet() {
      const body = {
        "User ID": Date.now(),
        "Round 1": times[0],
        "Round 2": times[1],
        "Round 3": times[2],
        "Timestamp": new Date().toISOString()
      };
      fetch("https://api.sheetbest.com/sheets/f2fb5301-75cc-4869-97d4-fc131fdec2b9", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
    }
  </script>
</body>
</html>
